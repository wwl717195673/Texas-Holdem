# Texas Hold'em 德州扑克 - 玩家手册

---

## 文档信息

| 项目 | 内容 |
|-----|------|
| 版本 | v1.0 |
| 游戏 | 德州扑克 (Texas Hold'em) |
| 平台 | 命令行 / WebSocket |

---

## 目录

1. [游戏概述](#1-游戏概述)
2. [游戏配置](#2-游戏配置)
3. [游戏流程](#3-游戏流程)
4. [操作指令](#4-操作指令)
5. [牌型规则](#5-牌型规则)
6. [下注系统](#6-下注系统)
7. [边池机制](#7-边池机制)
8. [术语表](#8-术语表)
9. [快速开始](#9-快速开始)
10. [界面说明](#10-界面说明)

---

## 1. 游戏概述

### 1.1 德州扑克简介

德州扑克是一种社区牌类游戏，每位玩家持有2张私有底牌（hole cards），与桌面上5张公共牌（community cards）组合成最好的5张手牌。

### 1.2 游戏目标

用手中的2张底牌和桌面上的5张公共牌，组合成最大的5张手牌，赢得底池中的筹码。

### 1.3 游戏人数

| 限制 | 数值 |
|-----|------|
| 最少玩家 | 2 |
| 最多玩家 | 9 |

---

## 2. 游戏配置

### 2.1 配置参数

```go
config := &game.Config{
    MinPlayers:     2,      // 最少玩家数
    MaxPlayers:     9,      // 最多玩家数
    SmallBlind:     10,     // 小盲注金额
    BigBlind:       20,     // 大盲注金额
    Ante:           5,     // 前注金额（可选，设为0禁用）
    StartingChips:  1000,   // 初始筹码
    ActionTimeout:  30,     // 动作超时（秒）
}
```

### 2.2 参数说明

| 参数 | 说明 | 建议值 |
|-----|------|--------|
| SmallBlind | 小盲注，每局强制投入 | 10-100 |
| BigBlind | 大盲注，SB的2倍 | 20-200 |
| Ante | 前注（可选），增加底池竞争性 | 0-10 |
| StartingChips | 初始筹码量 | 1000-10000 |

---

## 3. 游戏流程

### 3.1 游戏阶段顺序

```
┌─────────────────────────────────────────────────────────┐
│  等待开始 → 翻牌前 → 翻牌圈 → 转牌圈 → 河牌圈 → 摊牌  │
└─────────────────────────────────────────────────────────┘
```

### 3.2 各阶段说明

| 阶段 | 说明 | 发牌 | 下注轮 |
|-----|------|-----|-------|
| 等待开始 | 等待玩家加入和开始 | 无 | - |
| 翻牌前 | 庄家按钮确定后 | 底牌×2 | 第1轮 |
| 翻牌圈 | 发3张公共牌 | 公共牌×3 | 第2轮 |
| 转牌圈 | 发第4张公共牌 | 公共牌×1 | 第3轮 |
| 河牌圈 | 发第5张公共牌 | 公共牌×1 | 第4轮 |
| 摊牌 | 比较手牌，分配底池 | 无 | - |

### 3.3 详细流程图

```
开始游戏
    │
    ▼
庄家按钮轮转（BTN）
    │
    ▼
扣除前注（如果有配置）
    │
    ▼
扣除盲注（SB + BB）
    │
    ▼
发底牌（每人2张）
    │
    ▼
翻牌前下注 ────────┐
    │               │
    ▼               │
发翻牌（3张）      │
    │               │
    ▼               │
翻牌圈下注 ────────┤
    │               │
    ▼               │
发转牌（1张）      │
    │               │
    ▼               │
转牌圈下注 ────────┤
    │               │
    ▼               │
发河牌（1张）      │
    │               │
    ▼               │
河牌圈下注 ────────┤
    │               │
    ▼               │
摊牌比较           │
    │               │
    ▼               │
分配底池           │
    │               │
    ▼               │
游戏结束（返回等待开始）
```

### 3.4 庄家按钮流转

- 每局游戏结束后，庄家按钮（Dealer Button）顺时针传递给下一位玩家
- 庄家按钮位置决定小盲和大盲的位置

```
座位顺序: [0] [1] [2] [3] [4]
             ▲
          BTN位置

下一局: [0] [1] [2] [3] [4]
                  ▲
               BTN位置
```

---

## 4. 操作指令

### 4.1 可执行动作

| 动作 | 英文 | 快捷键 | 说明 |
|-----|------|-------|------|
| 弃牌 | Fold | F | 放弃当前局，不再参与 |
| 看牌 | Check | X | 无人下注时通过，不投入筹码 |
| 跟注 | Call | C | 匹配当前最高注额 |
| 加注 | Raise | R | 提高当前注额（至少2倍） |
| 全下 | All-in | A | 投入全部剩余筹码 |

### 4.2 动作示例

```bash
# 弃牌
F 或 fold

# 看牌
X 或 check

# 跟注
C 或 call

# 加注到指定金额
R 100 或 raise 100

# 全下
A 或 allin
```

### 4.3 动作规则

#### 弃牌 (Fold)
- 任何时候都可以弃牌
- 弃牌后本局不再参与
- 底牌被隐藏，不显示给其他玩家

#### 看牌 (Check)
- 当前下注额为0时才能看牌
- 不投入任何筹码
- 轮到下一位玩家

#### 跟注 (Call)
- 必须匹配当前最高下注
- 投入 `当前最高注 - 玩家已下注` 的差额

#### 加注 (Raise)
- 最小加注 = 当前最高注 × 2
- 例如：当前最高注20，最小加注到40
- 不能超过可用筹码

#### 全下 (All-in)
- 投入所有剩余筹码
- 自动进入全下状态
- 可能产生边池

---

## 5. 牌型规则

### 5.1 牌型大小（从大到小）

| 排名 | 牌型 | 英文 | 符号 | 描述 |
|-----|------|-----|-----|------|
| 1 | 皇家同花顺 | Royal Flush | RF | A-K-Q-J-10 同花色 |
| 2 | 同花顺 | Straight Flush | SF | 5张连续同花色 |
| 3 | 四条 | Four of a Kind | 4K | 四张相同点数 |
| 4 | 葫芦 | Full House | FH | 三条 + 一对 |
| 5 | 同花 | Flush | FL | 5张同花色 |
| 6 | 顺子 | Straight | ST | 5张连续点数 |
| 7 | 三条 | Three of a Kind | 3K | 三张相同点数 |
| 8 | 两对 | Two Pair | 2P | 两个对子 |
| 9 | 一对 | One Pair | 1P | 一个对子 |
| 10 | 高牌 | High Card | HC | 无组合，最大单牌 |

### 5.2 牌型示例

```
皇家同花顺:  A♠ K♠ Q♠ J♠ 10♠
同花顺:      9♥ 8♥ 7♥ 6♥ 5♥
四条:        K♠ K♥ K♦ K♣ Q♠
葫芦:        Q♠ Q♥ Q♦ 9♣ 9♥
同花:        J♠ 9♠ 7♠ 5♠ 3♠
顺子:        10♠ J♥ Q♦ K♠ A♥
三条:        7♠ 7♥ 7♦ 10♣ 4♠
两对:        J♠ J♥ 5♣ 5♦ A♠
一对:        A♠ A♥ K♦ Q♣ 10♠
高牌:        A♠ K♥ Q♣ J♦ 9♠
```

### 5.3 顺子大小比较

```
A-K-Q-J-10 (Broadway)    最大
K-Q-J-10-9
Q-J-10-9-8
J-10-9-8-7
10-9-8-7-6
9-8-7-6-5
8-7-6-5-4
7-6-5-4-3
6-5-4-3-2
A-2-3-4-5 (Wheel)        最小
```

### 5.4 牌型判断逻辑

1. **皇家同花顺**：10-J-Q-K-A 同花色
2. **同花顺**：5张连续同花色
3. **四条**：4张相同点数
4. **葫芦**：3张相同 + 2张相同
5. **同花**：5张同花色（不连续）
6. **顺子**：5张连续（不同花色）
7. **三条**：3张相同点数
8. **两对**：2组对子
9. **一对**：1组对子
10. **高牌**：无以上组合

### 5.5 平局处理

- 同级牌型比较：先比主要组合，再比踢脚（kicker）
- 完全相同：平分底池（余数给庄家位玩家）

```
示例：两人都是顺子
A♠ K♥ Q♣ J♦ 10♠  vs  A♥ K♠ Q♦ J♣ 10♥
比较：最高牌A相同 → 次高牌K相同 → ... → 10相同 → 平局
```

---

## 6. 下注系统

### 6.1 盲注结构

```
位置:   [庄家] [小盲] [大盲] [其他玩家...]
        BTN     SB     BB     ...
金额:    -      10     20     -
```

### 6.2 下注轮流程

1. **翻牌前（Pre-flop）**
   - 小盲下注 → 大盲下注 → 其他人依次行动

2. **翻牌圈（Flop）**
   - 发3张公共牌
   - 大盲左第一位开始行动

3. **转牌圈（Turn）**
   - 发第4张公共牌
   - 继续下注

4. **河牌圈（River）**
   - 发第5张公共牌
   - 最后下注机会

### 6.3 加注限制

```python
# 最小加注公式
最小加注 = 当前最高注 × 2

# 示例
当前最高注 = 50
最小加注 = 100  # 玩家需要下到100
```

### 6.4 前注（可选）

每局开始前所有玩家投入的固定小额注：

```
配置前注 = 5
4位玩家 × 5 = 前注池 20
+ 小盲10 + 大盲20 = 初始底池 50
```

---

## 7. 边池机制

### 7.1 什么是边池

当有玩家全下但其他玩家筹码更多时，产生边池。

### 7.2 边池示例

**场景**：3人游戏

| 玩家 | 筹码 | 全下金额 | 状态 |
|-----|------|---------|------|
| A | 50 | 50 | 全下 |
| B | 100 | 100 | 全下 |
| C | 150 | 150 | 全下 |

**边池分配**：

```
主池（Main Pot）:
  金额 = 50 × 3 = 150
  有资格：A, B, C

边池1:
  金额 = (100-50) × 2 = 100
  有资格：B, C

边池2:
  金额 = (150-100) × 1 = 50
  有资格：C
```

### 7.3 边池结算顺序

1. 从最小边池开始结算
2. 每个池由有资格玩家中手牌最强的人获得
3. 如果手牌相同，平分该池

### 7.4 边池判定规则

- 只有全下玩家参与边池
- 未全下玩家不能获得边池
- 弃牌玩家不能获得任何池

---

## 8. 术语表

### 8.1 位置术语

| 中文 | 英文 | 缩写 | 说明 |
|-----|------|-----|------|
| 庄家 | Dealer | BTN | 按钮位置，发牌者标记 |
| 小盲 | Small Blind | SB | 庄家左第一位 |
| 大盲 | Big Blind | BB | 庄家左第二位 |
| 枪口 | Under the Gun | UTG | 大盲左第一位 |
| 中位 | Middle Position | MP | 庄家左3-4位 |
| 关煞 | Cut-off | CO | 庄家右一位 |

### 8.2 动作术语

| 中文 | 英文 | 说明 |
|-----|------|------|
| 弃牌 | Fold | 放弃当前局 |
| 看牌 | Check | 不下注通过 |
| 跟注 | Call | 匹配下注 |
| 加注 | Raise | 增加下注 |
| 全下 | All-in | 投入全部筹码 |
| 过牌 | Check | 同看牌 |

### 8.3 牌型术语

| 中文 | 英文 | 缩写 |
|-----|------|-----|
| 皇家同花顺 | Royal Flush | RF |
| 同花顺 | Straight Flush | SF |
| 四条 | Four of a Kind | 4K |
| 葫芦 | Full House | FH |
| 同花 | Flush | FL |
| 顺子 | Straight | ST |
| 三条 | Three of a Kind | 3K |
| 两对 | Two Pair | 2P |
| 一对 | One Pair | 1P |
| 高牌 | High Card | HC |

### 8.4 其他术语

| 中文 | 英文 | 说明 |
|-----|------|------|
| 底池 | Pot | 所有下注的总额 |
| 前注 | Ante | 每局开始前的强制注 |
| 盲注 | Blind | 强制下注 |
| 公共牌 | Community Cards | 所有玩家共享的牌 |
| 底牌 | Hole Cards | 玩家私有的牌 |
| 摊牌 | Showdown | 最后比较手牌 |
| 弃牌 | Fold | 放弃这局 |

---

## 9. 快速开始

### 9.1 构建游戏

```bash
# 克隆项目
git clone <repository-url>
cd Texas-Holdem

# 构建
go build ./...

# 运行测试
go test ./...
```

### 9.2 基本游戏流程

```
1. 初始化游戏配置
2. 添加2-9位玩家
3. 开始游戏（StartHand）
4. 依次执行动作
5. 等待摊牌结果
6. 分配筹码
7. 重复步骤3-6
```

### 9.3 代码示例

```go
package main

import (
    "fmt"
    "github.com/wilenwang/just_play/Texas-Holdem/pkg/game"
    "github.com/wilenwang/just_play/Texas-Holdem/internal/common/models"
)

func main() {
    // 创建游戏配置
    config := &game.Config{
        MinPlayers:     2,
        MaxPlayers:     9,
        SmallBlind:     10,
        BigBlind:       20,
        Ante:           5,
        StartingChips:  1000,
        ActionTimeout:  30,
    }

    // 创建游戏引擎
    engine := game.NewEngine(config)

    // 添加玩家
    engine.AddPlayer("p1", "Alice", 0)
    engine.AddPlayer("p2", "Bob", 1)
    engine.AddPlayer("p3", "Charlie", 2)

    // 开始游戏
    engine.StartHand()

    // 获取游戏状态
    state := engine.GetState()
    fmt.Printf("当前阶段: %s\n", state.Stage)
    fmt.Printf("底池: %d\n", state.Pot)

    // 执行动作
    engine.PlayerAction("p1", models.ActionCall, 0)
    engine.PlayerAction("p2", models.ActionCheck, 0)
    engine.PlayerAction("p3", models.ActionRaise, 100)
}
```

---

## 10. 界面说明

### 10.1 终端界面布局

```
┌─────────────────────────────────────────────────────────────┐
│  Texas Hold'em - 命令行版 v1.0                              │
├─────────────────────────────────────────────────────────────┤
│  牌局 #15  |  盲注: 10/20  |  底池: 450  |  庄家: [P2]    │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│    公共牌:                                                   │
│    ┌───┐ ┌───┐ ┌───┐ ┌───┐ ┌───┐                          │
│    │ A♠│ │ K♠│ │ 7♦│ │   │ │   │                          │
│    └───┘ └───┘ └───┘ └───┘ └───┘                          │
│                                                             │
├─────────────────────────────────────────────────────────────┤
│ 玩家状态:                                                    │
│ [P1] Alice   筹码: 950   状态: 等待行动                      │
│ [P2] Bob     筹码: 1200  状态: 已看牌                       │
│ [P3] Charlie 筹码: 780   状态: 已弃牌                        │
├─────────────────────────────────────────────────────────────┤
│ 你的底牌:                                                    │
│ ┌───┐ ┌───┐                                                 │
│ │ A♥│ │ A♦│                                                 │
│ └───┘ └───┘                                                 │
├─────────────────────────────────────────────────────────────┤
│ 当前行动: 轮到你了                                           │
│ 下注: 50  最低跟注: 50  可行动: [F]弃牌 [C]跟注 [R]加注 [A]全下│
│ > _                                                           │
└─────────────────────────────────────────────────────────────┘
```

### 10.2 牌面显示

```
点数:  2 3 4 5 6 7 8 9 10 J Q K A
花色:  ♣ (梅花) ♦ (方块) ♥ (红心) ♠ (黑桃)

红心/方块 = 红色显示
梅花/黑桃 = 黑色显示

示例牌面:
[A♥] [K♠] [10♦] [J♣] [Q♠]
```

### 10.3 状态指示

| 状态 | 显示 | 说明 |
|-----|------|------|
| 活跃 | 绿色 | 可以行动 |
| 已弃牌 | 灰色 | 已退出本局 |
| 全下 | 黄色 | 投入全部筹码 |
| 获胜 | 金色 | 赢得底池 |

---

## 附录A：规则速查

### A.1 行动优先级

1. 弃牌 (Fold) - 立即结束本局
2. 全下 (All-in) - 投入全部筹码
3. 跟注 (Call) - 匹配当前下注
4. 加注 (Raise) - 提高下注额
5. 看牌 (Check) - 仅当无人下注

### A.2 获胜条件

1. 所有其他玩家弃牌
2. 摊牌时手牌最大

### A.3 平局条件

1. 手牌完全相同
2. 公共牌已构成最大牌型

---

## 附录B：常见问题

### Q1: 前注是必须的吗？
A: 前注是可选的。在PRD中标记为P2优先级，可以配置为0来禁用。

### Q2: 最小加注是多少？
A: 最小加注 = 当前最高下注 × 2

### Q3: 边池是如何产生的？
A: 当有玩家全下但其他玩家还有更多筹码时产生。

### Q4: 如何开始一局新游戏？
A: 所有玩家准备完成后，调用 `StartHand()` 方法。

### Q5: 庄家按钮有什么作用？
A: 决定盲注位置和小盲、大盲的顺序。

---

*文档版本: v1.0*
*创建日期: 2026-02-04*
