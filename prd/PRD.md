# 德州扑克命令行游戏 - 产品需求文档 (PRD)

## 文档信息

| 项目 | 内容 |
|-----|------|
| 项目名称 | Texas Hold'em CLI |
| 文档版本 | v1.0 |
| 目标平台 | 命令行 (macOS/Linux/Windows) |
| 开发语言 | Go |
| 文档状态 | 初稿 |

---

## 1. 项目概述

### 1.1 产品简介

开发一个基于命令行的德州扑克(Texas Hold'em)游戏，支持2-9名玩家在同一台机器上进行游戏。游戏采用无限注(No-Limit)规则，通过命令行界面与玩家交互。

### 1.2 核心目标

- 实现完整的德州扑克游戏流程
- 提供清晰的命令行用户界面
- 支持多人同屏游戏
- 确保游戏逻辑的正确性

### 1.3 目标用户

- 德州扑克初学者（学习游戏规则）
- 扑克爱好者（休闲娱乐）
- 开发者（学习Go语言项目）

---

## 2. 功能需求

### 2.1 游戏设置

| 功能 | 优先级 | 描述 |
|-----|-------|------|
| 创建新游戏 | P0 | 初始化游戏环境 |
| 配置玩家数量 | P0 | 支持2-9人游戏 |
| 设置初始筹码 | P1 | 每位玩家1000-10000筹码 |
| 设置盲注级别 | P1 | SB/BB配置 |
| 前注配置 | P2 | 可选前注功能 |

### 2.2 游戏流程

| 功能 | 优先级 | 描述 |
|-----|-------|------|
| 庄家按钮流转 | P0 | 每局顺时针传递 |
| 盲注自动扣除 | P0 | SB/BB强制下注 |
| 发底牌 | P0 | 每位玩家2张私有牌 |
| 翻牌圈 | P0 | 发3张公共牌 |
| 转牌圈 | P0 | 发第4张公共牌 |
| 河牌圈 | P0 | 发第5张公共牌 |
| 摊牌判定 | P0 | 自动比较牌型 |
| 底池分配 | P0 | 筹码分配 |

### 2.3 玩家行动

| 功能 | 优先级 | 描述 |
|-----|-------|------|
| 弃牌 (Fold) | P0 | 放弃当前局 |
| 看牌 (Check) | P0 | 无人下注时通过 |
| 跟注 (Call) | P0 | 匹配当前最高注 |
| 加注 (Raise) | P0 | 提高当前注额 |
| 全下 (All-in) | P0 | 投入全部筹码 |
| 边池支持 | P1 | 处理多人全下情况 |

### 2.4 牌型判定

| 功能 | 优先级 | 描述 |
|-----|-------|------|
| 皇家同花顺 | P0 | 识别最高牌型 |
| 同花顺 | P0 | 同花色顺子 |
| 四条 | P0 | 四张相同点数 |
| 葫芦 | P0 | 三条+一对 |
| 同花 | P0 | 五张同花色 |
| 顺子 | P0 | 五张连续 |
| 三条 | P0 | 三张相同点数 |
| 两对 | P0 | 两个对子 |
| 一对 | P0 | 一个对子 |
| 高牌 | P0 | 无组合时比最大 |

---

## 3. 非功能需求

### 3.1 性能需求

| 指标 | 要求 |
|-----|------|
| 响应时间 | 操作后1秒内显示结果 |
| 内存占用 | < 50MB |
| CPU占用 | < 10% 单核心 |

### 3.2 可靠性

- 牌型判定准确率 100%
- 筹码计算无误差
- 异常输入有明确提示

### 3.3 可用性

- 清晰的错误提示
- 简洁的操作命令
- 游戏状态实时显示

---

## 4. 用户界面设计

### 4.1 主菜单

```
╔═══════════════════════════════════════╗
║       德州扑克 - 命令行版 v1.0        ║
╠═══════════════════════════════════════╣
║  1. 开始新游戏                        ║
║  2. 游戏规则说明                      ║
║  3. 退出                              ║
╚═══════════════════════════════════════╝
```

### 4.2 游戏界面

```
┌─────────────────────────────────────────────────────────────┐
│ 牌局 #15  |  盲注: 10/20  |  底池: 450  |  庄家: [P2]       │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│    公共牌:                                                   │
│    ┌───┐ ┌───┐ ┌───┐ ┌───┐ ┌───┐                          │
│    │ A♠│ │ K♠│ │ 7♦│ │   │ │   │                          │
│    └───┘ └───┘ └───┘ └───┘ └───┘                          │
│                                                             │
├─────────────────────────────────────────────────────────────┤
│ 玩家状态:                                                    │
│ [P1] 你      筹码: 950   状态: 等待行动                      │
│ [P2] AI-1   筹码: 1200  状态: 已看牌                        │
│ [P3] AI-2   筹码: 780   状态: 已弃牌                       │
│ [P4] AI-3   筹码: 2100  状态: 全下                          │
├─────────────────────────────────────────────────────────────┤
│ 你的底牌:                                                    │
│ ┌───┐ ┌───┐                                                 │
│ │ A♥│ │ A♦│  你持有: 一对A (高牌型: 四条A)                   │
│ └───┘ └───┘                                                 │
├─────────────────────────────────────────────────────────────┤
│ 当前行动: 轮到你了                                           │
│ 下注: 50  最低跟注: 50  可行动: [F]弃牌 [C]跟注 [R]加注 [A]全下│
│ > _
└─────────────────────────────────────────────────────────────┘
```

### 4.3 命令格式

| 命令 | 简写 | 说明 | 示例 |
|-----|-----|------|------|
| fold | f | 弃牌 | `f` 或 `fold` |
| check | c | 看牌 | `c` 或 `check` |
| call | ca | 跟注 | `ca` 或 `call` |
| raise | r | 加注 | `r 100` |
| allin | a | 全下 | `a` 或 `allin` |
| help | h | 帮助 | `h` |
| quit | q | 退出游戏 | `q` |

---

## 5. 系统架构

### 5.1 模块结构

```
Texas-Holdem/
├── cmd/
│   └── main.go                    # 程序入口
├── internal/
│   ├── game/
│   │   ├── game.go               # 游戏主逻辑
│   │   ├── state.go              # 游戏状态
│   │   └── betting.go            # 下注逻辑
│   ├── dealer/
│   │   ├── dealer.go             # 发牌逻辑
│   │   └── deck.go               # 牌组管理
│   ├── player/
│   │   ├── player.go             # 玩家数据
│   │   └── ai.go                 # AI玩家(可选)
│   ├── evaluator/
│   │   ├── evaluator.go          # 牌型评估
│   │   └── hand_rank.go          # 牌型定义
│   └── ui/
│       ├── display.go            # 控制台显示
│       └── input.go              # 玩家输入
├── prd/
│   └── 德州扑克游戏手册.md
└── README.md
```

### 5.2 核心数据结构

#### 5.2.1 牌

```go
type Suit int // 花色 (0-3)
type Rank int // 点数 (2-14, 11=J, 12=Q, 13=K, 14=A)

type Card struct {
    Suit Suit
    Rank Rank
}
```

#### 5.2.2 玩家

```go
type Player struct {
    ID       int
    Name     string
    Chips    int
    Position int      // 相对于庄家的位置
    HoleCards [2]Card // 底牌

    // 状态
    IsActive   bool    // 是否仍在当局
    HasFolded  bool    // 是否已弃牌
    IsAllIn    bool    // 是否全下
    CurrentBet int     // 当前下注额
}
```

#### 5.2.3 游戏状态

```go
type GameState int // 枚举: 空闲, 翻牌前, 翻牌圈, 转牌圈, 河牌圈, 摊牌

type Game struct {
    Players       []Player
    Dealer        Dealer
    CommunityCards [5]Card
    Pot           int
    State         GameState
    DealerButton  int // 庄家位置索引
    CurrentPlayer int // 当前行动玩家
    CurrentBet    int // 当前最高下注
}
```

---

## 6. 开发计划

### 阶段一: 核心功能

- [ ] 牌组管理 (Deck)
- [ ] 发牌逻辑 (Dealer)
- [ ] 玩家数据结构
- [ ] 基本游戏循环

### 阶段二: 牌型评估

- [ ] 牌型枚举定义
- [ ] 牌型评估算法
- [ ] 手牌比较函数
- [ ] 胜负判定逻辑

### 阶段三: 下注系统

- [ ] 下注状态管理
- [ ] 边池计算
- [ ] 筹码分配
- [ ] 全下处理

### 阶段四: 用户界面

- [ ] 游戏界面渲染
- [ ] 玩家输入处理
- [ ] 实时状态更新
- [ ] 帮助信息

### 阶段五: 测试完善

- [ ] 单元测试
- [ ] 边界测试
- [ ] 性能优化
- [ ] 文档完善

---

## 7. 测试策略

### 7.1 单元测试覆盖

| 模块 | 测试内容 |
|-----|---------|
| Deck | 洗牌均匀性, 发牌正确性 |
| Evaluator | 10种牌型判定 |
| Betting | 下注计算, 边池分配 |
| Game | 状态流转, 异常处理 |

### 7.2 测试用例

- 各种牌型组合测试
- 边界情况测试 (全下, 弃牌, 平分)
- 输入验证测试

---

## 8. 风险与约束

### 8.1 技术风险

| 风险 | 缓解措施 |
|-----|---------|
| 牌型评估复杂 | 使用成熟的评估算法, 充分测试 |
| 状态机复杂 | 使用有限状态机模式, 清晰的状态转换 |

### 8.2 项目约束

- 纯命令行界面, 无网络功能
- 单机运行, 无需数据库
- 建议单人开发, 2-4周完成

---

## 9. 验收标准

### 功能验收

- [ ] 2-9名玩家可正常开始游戏
- [ ] 完整经历 盲注→底牌→翻牌→转牌→河牌→摊牌 流程
- [ ] 所有下注选项 (弃牌/看牌/跟注/加注/全下) 可正常使用
- [ ] 10种牌型判定准确
- [ ] 筹码分配正确

### 体验验收

- [ ] 游戏状态清晰展示
- [ ] 操作简单直观
- [ ] 错误信息明确

---

## 10. 附录

### 10.1 术语对照

| 中文 | 英文 | 缩写 |
|-----|------|-----|
| 庄家 | Dealer/Button | BTN |
| 小盲注 | Small Blind | SB |
| 大盲注 | Big Blind | BB |
| 弃牌 | Fold | F |
| 看牌 | Check | X/C |
| 跟注 | Call | C |
| 加注 | Raise | R |
| 全下 | All-in | A |

### 10.2 参考资源

- 德州扑克规则: `prd/德州扑克游戏手册.md`
- Go语言官方文档: https://golang.org/doc/

---

*文档版本: v1.0*
*创建日期: 2026-02-04*
